
\clearpage
# MODÈLE BAYÉSIEN HIÉRARCHIQUE AVEC LES DONNÉES SUR LE STOCK-RECRUTEMENT DU SAUMON ROUGE DANS LES RÉSEAUX DE LA RIVIÈRE SKEENA {#app:HBMFits}



```{r,echo=FALSE, message=FALSE}
library(tidyverse)
library(csasdown)

HBM.results <- readRDS("data/HBM/HBM_appendix_tables.rds")

pasteList <- function(x, suffix=NULL) {
  n <- length(x)
  if (!is.null(suffix)) x <- paste0(x, suffix)
  if(n == 1) return(x)
  a <- paste(head(x, n=(n-1)), collapse = ", ")
  paste(c(a, tail(x, 1)), collapse = ", and ")
}
# str(HBM.results)

# TASKS
# - Standardize terms: lognormal or log-normal,  capitalize Normal?
# - methods - include JAGS
# - [ ] prettyNum
# -[ ] intro to sensitivity
# - [ ] Citations
# - [ ] shrinkage 
# - [ ] Umsy definition
```

<!-- 
Questions

Normal draws were defined in terms of precision, does the remainder of the document

See equation \@ref(eq:HBMLinRick)
-->

**Annexe fournie par Murdoch McAllister et Wendell Challenger**

*Remarque : Cette annexe est une contribution autonome au document de recherche. Elle a été incluse comme contre-vérification des résultats clés (p. ex. scénarios de productivité) et pour établir un lien entre les analyses des géniteurs-recrues d’un seul stock présentées dans le corps du rapport et les travaux antérieurs de @KormanEnglish2013, qui ont utilisé une approche bayésienne hiérarchique. Cette annexe applique l’approche de @KormanEnglish2013 aux données sur les géniteurs-recrues mises à jour et comprend des tests de sensibilité approfondis pour permettre des comparaisons plus directes avec les ajustements du modèle à un seul stock.*

Un MBH a été élaboré pour l’estimation des paramètres du modèle stock-recrutement de Ricker pour les stocks de saumon rouge du bassin versant de la rivière Skeena. Le temps a manqué pour préparer un MBH pour les stocks du bassin versant de la rivière Nass. Cette structure a été utilisée parce qu’on a supposé que l’échangeabilité du paramètre de la productivité des stocks était limitée aux stocks dans chaque bassin versant. La distribution de la fréquence des caractéristiques du cycle biologique des stocks, comme la composition selon l’âge des géniteurs, la fréquence relative des types de cycle biologique à croissance dans les lacs et autres, les périodes de montaison et les voies de migration en milieu marin sont différentes entre les stocks de saumon rouge dans ces deux bassins versants.  



## FORMULES MATHÉMATIQUES ET STATISTIQUES DU MBH {#app:HBMFits-1}

Les MBH de la rivière Skeena utilisent une forme linéarisée du modèle stock-recrutement de Ricker :


\begin{equation}
\log{\left(\frac{R_{s,y}}{S_{s,y}}\right)=a_s-}\beta_s\cdot\ S_{s,y}+\epsilon_{s,y}
(\#eq:HBMLinRick)
\end{equation}

où $R_{s,y}$ est l’abondance observée des recrues produites dans le stock $s$ l’année d’éclosion $y$ par l’abondance correspondante des géniteurs l’année d’éclosion $S_{s,y}$. Le paramètre $a_s$ est le logarithme naturel du taux maximal d’augmentation de la population, $\beta_s$ est le coefficient propre au stock pour l’effet dépendant de la densité de l’abondance des géniteurs sur la productivité du stock et $\epsilon_{s,y}$ représente le terme d’erreur du stock par année qui est censé avoir une distribution normale.

Le cadre du MBH présenté repose sur celui formulé par @KormanEnglish2013, qui ont estimé les paramètres de stock-recrutement pour de nombreux stocks de saumon dans le réseau de la rivière Skeena. Le MBH suppose, comme @KormanEnglish2013, que le paramètre $a$ de Ricker est échangeable entre les stocks d’un réseau fluvial avec une moyenne hyper a priori et un écart-type hyper a priori :


\begin{equation}
  a_s \sim  \ln \textrm{Normal}\left(\mu_a,\ \tau_a\right) 
\end{equation}

où $\mu_a$ est le logarithme naturel de la médiane hyper a priori du paramètre $a$ de Ricker, et $\tau_a$ est la précision hyper a priori du paramètre $a$ de Ricker. Les valeurs hyper a priori suivantes ont été attribuées à $\mu_a$ et à $\tau_a$ :
  
\begin{equation}
  \mu_a \sim \textrm{Normal}\left({0.5,\ 10^{-6}}\right)
  \textrm{, and }
  \tau_a \sim  \textrm{Gamma} \left(0.5,\ 0.5 \right).
\end{equation}


@KormanEnglish2013 ont choisi ces a priori comme des a priori vagues et nous avons repris les mêmes hyper a priori dans les formules actuelles.

Une valeur a priori log-normale informative a également été supposée pour le paramètre $\beta_s$ de densité-dépendance qui suit la formulation utilisée dans @KormanEnglish2013 :

\begin{equation}
  \beta_s \sim \ln \textrm{Normal}\left(\mu_{\beta,s},\ \tau_{\beta,s}\right)
\end{equation}

où $\mu_{\beta,s}$  a été tiré des résultats d’analyses limnologiques antérieures de la productivité des lacs qui ont évalué l’abondance des géniteurs (c.-à-d. $S_{\textrm{max},s})$ qui pourrait produire en moyenne le nombre maximal de recrues pour chaque stock. Les valeurs $\mu_{\beta,s}$  et $\tau_{\beta,s}$ ont été déterminées comme suit :

  
\begin{equation}
  \mu_{\beta,s}= \log \left(  \frac{1}{S_{\textrm{max},s}} \right)
  \textrm{,  and  } 
  \tau_{\beta,s}=\left(\frac{1}{\sigma_{\textrm{max},s}}\right)^2.
\end{equation}
  
  
 où $\sigma_{\textrm{max},s}$ est l’écart type a priori dans le logarithme naturel de $S_{\textrm{max},s}$. Il faut noter que les valeurs de $\sigma_{\textrm{max},s}$ sont presque identiques au coefficient de variation pour les valeurs plus petites de $\sigma_{\textrm{max},s}$(environ 0,5 et moins) et que, par conséquent, nous utilisons le coefficient de variation et $\sigma_{\textrm{max},s}$ de façon interchangeable pour décrire la précision de la valeur a priori. Cela dit, le rapport entre le coefficient de variation et $\sigma_{\textrm{max},s}$) augmente nettement au-dessus de 1 (c.-à-d. que le coefficient de variation est plus grand que $\sigma_{\textrm{max},s}$) à des valeurs plus grandes de $\sigma_{\textrm{max},s}$, ce qui signifie que le coefficient de variation réel est plus grand que celui indiqué et que la valeur a priori sera plus diffuse. Les valeurs de $S_{\textrm{max},s}$ et de $\sigma_{\textrm{max},s}$ pour chaque stock dans le bassin versant de la rivière Skeena sont indiquées dans le tableau \@ref(tab:PrSmax). 
  
  
<!-- TABLE C.1. Smax Priors -->
```{r PrSmax, echo=FALSE, results='asis'}
cap <- "Médiane des valeurs a priori de $S_\\textrm{max}$  propre au stock et écart type a priori dans le logarithme naturel de $S_\\textrm{max}$ (c.-à-d. $\\sigma_{\\textrm{max},s}$) d’après les résultats d’analyses précédentes de la productivité des lacs. Dans les deux cas où trois stocks sont répertoriés sur la même ligne, les valeurs moyennes de $S_\\textrm{max}$ accessibles ont été ajoutées puisque les différents lacs de croissance de ces stocks étaient géographiquement très proches et les données sur le stock-recrutement pour ces stocks ont donc été combinées en une seule série chronologique de données sur le stock-recrutement pour l’estimation des paramètres de stock-recrutement."


# data.frame(Yes = 1:10, No = LETTERS[11:20]) %>%
HBM.results$Smax %>%
  filter(Basin == "Skeena") %>%
  mutate(prSmax = prettyNum(round(prSmax),big.mark=" ")) %>%
  mutate(prCV= prettyNum(prCV,decimal.mark=",")) %>%
  mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  rename(
     Lac = Lake,
	 Bassin = Basin,
    `$S_{\\textrm{max},s}$` = prSmax,
    `CV/$\\sigma_{\\textrm{max},s}$` = prCV
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l","l", "l", "r", "r"),
    caption = cap
  )
```

Les valeurs de $\sigma_{\textrm{max},s}$ ont été tirées, pour la plupart des stocks de saumon rouge de la rivière Skeena, de @KormanEnglish2013). Il convient de noter qu’une valeur de 2,00 pour $\sigma_{\textrm{max},s}$  rend la valeur a priori correspondante de $S_{\textrm{max},s}$ vague et diffuse. Par exemple, par rapport à la médiane, les limites inférieures et supérieures des intervalles de crédibilité à 95 % seraient environ cinquante fois plus basses et cinquante fois plus élevées que la médiane. Dans les cas où la valeur de  $\sigma_{\textrm{max},s}$ a été fixée à 2,00, au moins certains membres du groupe de travail ont soulevé des préoccupations au sujet de la base empirique des valeurs de $S_{\textrm{max},s}$  que l’on pourrait obtenir pour ces stocks. Les stocks du lac Babine représentaient un regroupement de stocks qui a été divisé en cinq, celui de la rivière Asitka reposait sur une approximation et celui de la rivière Morice était un réseau de deux lacs dont seul le plus grand a été mesuré. En raison de ces problèmes, nous avons utilisé des valeurs a priori diffuses pour ces stocks.

Au moment de l’analyse, aucune estimation de la productivité du lac n’était disponible pour la rivière Asitka. De ce fait, une approximation brute de la médiane a priori de $S_{\textrm{max},s}$ pour la rivière Asitka a été tirée du produit de la superficie du lac pour la rivière Asitka et de la moyenne de $S_{\textrm{max},s}$ par unité de superficie du lac pour les lacs du bassin versant de la rivière Skeena pour lesquels des estimations de $S_{\textrm{max},s}$ pour le saumon rouge étaient accessibles. En raison de la grande incertitude entourant $S_{\textrm{max},s}$ pour le stock de la rivière Asitka, nous avons supposé une valeur de 2,00 pour $\sigma_{\textrm{max},s}$  de ce stock, ce qui en fait une valeur a priori vague.

Pour les cinq stocks du lac Babine, une grande incertitude entoure la capacité des lacs pour chaque stock en raison de l’incertitude concernant la façon dont la ressource commune est partagée entre les cinq stocks étant donné que les juvéniles d’au moins cinq des stocks reconnus du lac Babine grandissent dans le lac. La médiane a priori de $S_{\textrm{max},s}$ pour chacun des cinq stocks du lac Babine a été calculée en divisant l’estimation de la productivité totale du lac Babine par cinq, ce qui donne une répartition égale de la ressource partagée pour chaque stock du lac Babine. Étant donné que la proportion réelle de la productivité du lac utilisée par chaque stock demeure inconnue, un niveau élevé d’incertitude (c.-à-d. une valeur de 2,00 de $\sigma_{\textrm{max},s}$) a été attribué à chaque stock du lac Babine.

Comme dans @KormanEnglish2013, nous avons appliqué une fonction de vraisemblance normale dans le MBH et la même valeur a priori à l’écart type des écarts entre la productivité prévue et la productivité observée :


\begin{equation}
  \log{\left(\frac{R_{s,y}}{S_{s,y}}\right) \sim   \textrm{Normal}\left(\mu_{s,y}^{RS},\  \tau_s \right)} 
\end{equation}

où $\log(R_{s,y}/S_{s,y})$ est le logarithme naturel observé du ratio des recrues produites par les géniteurs (c.-à-d. la productivité) l’année d’éclosion $y$ pour le stock $s$, $\mu_{s,y}^{RS}$ est la productivité propre au stock prévue par le modèle stock-recrutement de Ricker (voir l’équation (\@ref(eq:HBMLinRick))), conditionné par les paramètres $a_s$ et $\beta_s$, et $\tau_s$  est la précision propre au stock utilisée dans la fonction de vraisemblance et donnée par la formule 

\begin{equation}
  \tau_s=\frac{1}{\sigma_s^2}
\end{equation}
 
où $\sigma_s$ est l’écart type propre au stock dans les écarts entre la productivité observée et la productivité prévue. La valeur a priori pour $\sigma_s$ est la même que celle appliquée dans @KormanEnglish2013 : 


\begin{equation}
  \sigma_s \sim \textrm{Uniform}(0.05,\ 10).
\end{equation}

Le MBH original de @KormanEnglish2013 ne tenait pas compte des variations temporelles de la productivité; comme ce point présentait un intérêt dans l’étude actuelle, nous avons étendu le MBH de @KormanEnglish2013 pour inclure un effet annuel commun sur la productivité du stock (c.-à-d. $\log(R_{s,y}/S_{s,y})$). On pose l’hypothèse qu’en raison de la proximité spatiale des stocks de saumon rouge dans un bassin versant (celui de la rivière Skeena) et le chevauchement entre les stocks dans les voies de migration en eau douce et en mer, la productivité annuelle de différents stocks s’écartera des prévisions du modèle de Ricker dans le même sens et d’une ampleur semblable chaque année. Ainsi, en plus d’un écart propre au stock entre la prévision de la productivité dans le modèle de Ricker et la productivité observée, un écart ou un effet annuel commun a également été inclus dans le MBH. La forme linéarisée du modèle de Ricker qui comprend l’effet annuel commun $T_y$ l’année $y$ est donc donnée par la formule :

\begin{equation}
  \mu_{s,y}^{RS}=a_s-\beta_s\cdot S_{s,y}+T_y
\end{equation}
  
La valeur a priori de $T_y$ est donnée par la formule :


\begin{equation}
  T_y \sim \textrm{Normal}\left(0,\ \tau_T\right)
\end{equation}
  
 où $\tau_T$ est la précision a priori dans l’effet annuel commun, qui est calculée comme $\tau_T=1/\sigma_T^2$, avec $\sigma_T$  représentant l’écart type dans les effets annuels communs. La valeur hyper a priori pour $\sigma_T$  a été déterminée comme suit : 
  

\begin{equation}
  \sigma_T \sim \ln \textrm{Normal} \left(\log{\left(0.8\right),\ \frac{1}{{0.7}^2}}\right).
\end{equation}


La valeur a priori de  $\sigma_T$ a été choisie de manière à être légèrement informative avec la tendance centrale a priori et la précision a priori établies à des valeurs qui permettent aux données d’informer une vaste fourchette de valeurs et de tenir compte d’une variation interannuelle potentiellement importante des effets annuels communs.

L’estimation des effets annuels communs devrait représenter les écarts moyens par rapport aux prévisions de la productivité du stock par le modèle de Ricker pour l’ensemble des stocks une année donnée. L’effet annuel commun pourrait résulter de taux de survie supérieurs ou inférieurs à la moyenne en raison de la mortalité naturelle du stock une année donnée en eau douce ou en mer. Cependant, il peut également résulter d’erreurs de reconstitution des remontes, comme une sous-estimation ou une surestimation de la prise totale.






## AJUSTEMENT DES MODÈLES

Les algorithmes MCCM appliqués à l’intégration a posteriori du MBH étaient WinBUGS 1.4.3 et JAGS, et les deux progiciels ont donné des estimations des paramètres pratiquement identiques. Dans la mise en œuvre initiale de WinBUGS, le rodage a été réalisé en environ 10 000 itérations et des fonctions de densité a posteriori bien prononcées ont été obtenues pour les estimations des paramètres. Cependant, avec les deux progiciels, pour certains stocks, les chaînes MCCM pouvaient très rarement s’écarter jusqu’à des valeurs extrêmement faibles pour le paramètre $\beta$ de Ricker ou à des valeurs extrêmement élevées pour le paramètre $a$ de Ricker. Les valeurs extrêmement faibles du paramètre $\beta$ de Ricker vont jusqu’à des valeurs extrêmement élevées, par exemple dix fois la valeur du mode a posteriori, pour des paramètres dérivés comme l’abondance moyenne non exploitée des géniteurs, $S_0$, ou l’abondance du stock reproducteur associée au rendement maximal durable, $S_{rmd}$. De telles valeurs aberrantes extrêmes ont été considérées comme bien en dehors du soutien des données et peuvent être des artefacts du fonctionnement des algorithmes MCCM appliqués.


Pour éviter l’inclusion de valeurs aberrantes extrêmes, une borne minimale a été appliquée à la valeur a priori du paramètre $\beta$ de Ricker. La valeur minimale a priori du paramètre $\beta$ de Ricker a été établie comme suit. Une borne supérieure de la valeur de $S_\textrm{max}$  a été calculée pour chaque stock, soit cinq fois la tendance centrale a priori spécifiée pour $S_\textrm{max}$ : 


\begin{equation}
  S_{\textrm{max},\textrm{max},s} = 5 \times S_{\textrm{max},s} \textrm{ and } \beta_{\textrm{min},s}=\frac{1}{S_{\textrm{max},\textrm{max},s}}. 
\end{equation}

La valeur a priori ajustée pour $\beta_s$ qui a été appliquée était donc :

\begin{equation}
  \textrm{max}\left(\beta_s \sim \ \ln \textrm{Normal}\left(\mu_{\beta,s},\ \ \tau_{\beta,s}\right),\ \beta_{\textrm{min},s}\right)
\end{equation}

L’application de cette valeur a priori modifiée pour $\beta_s$ a ainsi empêché des valeurs anormalement faibles de $\beta_s$ et des valeurs MCCM anormalement grandes pour les points de référence fondés sur l’abondance tels que $S_\textrm{max}$ , $S_\textrm{rmd}$, and $S_0$.

La distribution prédictive a posteriori du paramètre a de Ricker pour une population non échantillonnée, a_p, est donnée par la formule qui suit :


\begin{equation}
  a_p \sim\  \ln \textrm{Normal}\left(\mu_a,\ \tau_a\right)
  (\#eq:unsamp)
\end{equation}
  

Cette distribution reflète la fonction de densité a priori effective pour le paramètre $a$ de Ricker qui a été appliquée pour estimer ce paramètre pour chaque stock.

Afin de fournir des approximations de la façon dont la productivité pourrait varier de façon systématique au fil des ans, nous avons obtenu des représentations de la productivité variable dans le temps en ajoutant les moyennes mobiles $n = 4$ ou 5 ans des effets annuels communs au paramètre $a$ pour chaque stock :

\begin{equation}
  a_{s,y,n}=a_s+\frac{1}{n}\cdot\sum_{i=y-n+1}^{y}T_i
  (\#eq:timevarprod)
\end{equation}


Les estimations finales des distributions a posteriori ont été dérivées dans JAGS en exécutant six chaînes indépendantes avec des points de départ différents pour 100 000 itérations MCCM après un rodage de 20 000. Les échantillons a posteriori ont été éclaircis en conservant un échantillon sur dix afin de réduire l’autocorrélation dans les paramètres fondamentaux et dérivés. La convergence a été évaluée au moyen d’une combinaison de tracés diagnostiques (p. ex. graphiques des traces, distributions a posteriori et tracés Gelman-Rubin-Brooks) et de critères comme le facteur de réduction d’échelle potentiel de Rhat, Gelman et Rubin [@GelmanRubin1992], y compris la version multivariée [@BrooksGelman1998], et le diagnostic de Geweke [@Geweke1992]. Dans tous les cas, les tracés ont montré de bons échantillonnages à partir de la valeur a posteriori avec peu ou pas d’autocorrélation et indiqué que tous les critères de diagnostic se situaient dans des fourchettes généralement associées à la convergence (c. à d. Rhat < 1,05, Gelman-Rubin dans la fourchette [0,99; 1,01] et Geweke dans la fourchette [-2; 2]).





## ANALYSES DE SENSIBILITÉ {#app:HBMFits-2}


Des exécutions supplémentaires du modèle ont été mises en œuvre pour évaluer certaines caractéristiques différentes du MBH. Voir une brève description de ces exécutions supplémentaires dans le tableau \@ref(tab:SensitivityRuns). Nous désignons l’exécution du modèle en utilisant les spécifications décrites ci-dessus pour le « scénario de référence » du MBH. Il faut noter que les résultats présentés ci-dessous ont été obtenus à partir de versions antérieures du code WinBUGS 1.4.3 du MBH, qui comprenaient une approximation plus simple pour calculer $S_\textrm{RMD}$  (à partir du tableau 7.2 de @HilbornWalters1992 que celle utilisée dans le corps du document. Les résultats de ces exécutions supplémentaires sont résumés ci-dessous.

  
<!-- TABLE C.2. Sensitivity Analyses -->
```{r SensitivityRuns, echo=FALSE, results='asis'}
cap <- "Description des analyses de sensibilité pour évaluer la sensibilité des résultats de l’estimation à la structure du modèle et à certains intrants clés."

data.frame(
  `Exécution` = c(seq(1,6), "7-24", "25", "26"), 
  Description = c(
    "Scénario de référence du MBH, mais incluant le codage de Korman et English (2013) dans la précision de calcul de la fonction de vraisemblance de $\\sigma$",
    "Identique au scénario de référence du MBH, mais sans borne inférieure a priori sur $\\beta$.",
    "Identique au scénario de référence du MBH, mais sans tenir compte des effets annuels communs.",
    "Exécution de modèle non hiérarchique sans effet annuel commun, mais incluant les mêmes informations a priori de $S_\\textrm{max}$ que dans le scénario de référence du MBH.",
    "Identique au scénario de référence du MBH, mais valeurs a priori normales de $S_\\textrm{max}$ au lieu de la valeur a priori log-normale du scénario de référence sur le $\\beta$ de Ricker.",
	"Identique au scénario de référence du MBH, mais valeurs vague a priori sur le $\\beta$ de Ricker, mais incluant le limite inférieure antérieure sur le $\\beta$ de Ricker.",
    "Omettre les données sur le stock-recrutement dans le MBH, un stock à la fois.",
	"Omettre les données sur le stock-recrutement pour les stocks mis en valeur du lac Babine dans le MBH (ruisseau Pinkut et rivière Fulton).",
    "Identique au scénario de référence du MBH, mais omettre les stocks mis en valeur du lac Babine (ruisseau Pinkut et rivière Fulton) et appliquer des valeurs a priori vagues de $S_\\textrm{max}$ aux stocks des rivières Bear, Kitwanga et Sustut."
  ),
  check.names = FALSE
) %>%
  csas_table(
    format = "latex", 
    escape = FALSE, 
    font_size = 10, 
    # align = c("p{1.2cm}","p{12cm}"),
    align = c("l", "l"),
    caption = cap, #paste("(tab:SensitivityRuns)", cap)
  ) %>%
  kableExtra::row_spec(seq(1,8), hline_after = TRUE) %>%
  kableExtra::column_spec(2, width = "12cm")
```


## RÉSULTATS

### Rétrécissement du paramètre a de Ricker lorsque l’on passe d’un modèle autre que le MBH au MBH  {#HBMShrinkage}

```{r, echo=FALSE}
shrink <- (HBM.results$Shrinkage$Shrinkage * 100) %>% range() %>% round
kitwanga <- round((HBM.results$Shrinkage %>% filter(Stock == "Kitwanga") %>% select(Shrinkage) %>% unlist)*100 )
pinkut <- round((HBM.results$Shrinkage %>% filter(Stock == "Pinkut") %>% select(Shrinkage) %>% unlist)*100 )
fulton <- round((HBM.results$Shrinkage %>% filter(Stock == "Fulton") %>% select(Shrinkage) %>% unlist)*100 )
other <- HBM.results$Shrinkage %>% filter(Stock %in% c("Kitwanga", "Pinkut", "Fulton" == FALSE)) %>% select(Shrinkage) %>% unlist %>% range
other <-round(other*100,1)
sig.sd <- (HBM.results$Shrinkage$`Diff.SD` * -100) %>% range() %>% round(digits = 1)  # % reduction
```

Dans les deux modèles, l’effet annuel commun a été estimé pour valider l’analyse de rétrécissement. Dans le modèle autre que le MBH, la valeur a priori du paramètre $a$ de Ricker pour chaque stock était log-normale de la même manière, avait une médiane a priori a de $\log(0.5)$  et une précision de 1. Comparativement au modèle autre que le MBH, on observe un rétrécissement modéré pour les estimations du MBH (figure \@ref(fig:HBMShrinkage)). Par exemple, le stock de la rivière Asitka, qui avait la valeur médiane a posteriori la plus élevée pour le paramètre $a$ de Ricker dans les deux modèles, affichait une diminution de `r -shrink[1]` % du paramètre a de Ricker (tableau \@ref(tab:HBMShrinkageVal)). Il s’agit de la plus forte diminution en pourcentage parmi les stocks de saumon rouge de la rivière Skeena inclus dans le MBH. Par contraste, le stock de la rivière Kitwanga, qui avait la deuxième médiane a posteriori la plus faible pour le paramètre $a$  de Ricker dans le modèle autre que le MBH, affichait la plus forte augmentation, de `r kitwanga` %, en passant du modèle autre que le MBH au MBH. En revanche, les stocks du ruisseau Pinkut et de la rivière Fulton dont les médianes a posteriori étaient proches du milieu de la fourchette de la médiane des estimations a posteriori pour le $a$ de Ricker dans le modèle autre que le MBH, présentaient un rétrécissement très faible, soit `r pinkut` % and `r fulton` %, respectivement (figure \@ref(fig:HBMShrinkage), tableau \@ref(tab:HBMShrinkageVal)). Pour les 18 stocks de saumon rouge de la rivière Skeena, l’écart type a posteriori pour les estimations du paramètre $a$ de Ricker était plus petit, soit de `r sig.sd[1]` % a `r sig.sd[2]` % plus bas, dans le MBH que dans le modèle autre que le MBH (tableau \@ref(tab:HBMShrinkageVal)).


<!-- Figure C.1. Shrinkage Plot -->
```{r, echo=FALSE}
cap <- "Graphique de rétrécissement de la médiane des valeurs a posteriori pour le paramètre $a$ de Ricker obtenu à l’aide des données sur le stock-recrutement du modèle autre que le MBH et du MBH pour 18 stocks de saumon rouge de la rivière Skeena."
```
```{r HBMShrinkage, echo=FALSE, fig.width=7, fig.cap=cap}
HBM.results$Shrinkage %>%
  select(Stock, ends_with("median")) %>%
  gather(key=Model, value = Median, ends_with("median")) %>%
    mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  mutate(
    Model = str_replace(Model, "[\\.[:space:]]median", "") %>% factor(levels = c("nonHBM", "HBM"))
  ) %>%
  ggplot(., aes(x=Model, y = Median)) +
  geom_point(aes(color = Stock)) +
  geom_line(aes(group = Stock, color = Stock)) +
  theme_classic(14) +
  theme(legend.title = element_blank()) +
  labs(
  x= "Modèle",
    y = "Valeur a posteriori médiane"
  )
```

<!-- TABLE C.3. Ricker a shrinkage -->
```{r HBMShrinkageVal, echo=FALSE, results='asis'}
cap <- "Médiane des estimations a posteriori et écarts types pour le paramètre $a$ de Ricker pour les 18 stocks de saumon rouge de la rivière Skeena dans le MBH et l’autre modèle. La variation en pourcentage montre la variation en pourcentage de l’estimation du paramètre quand on passe de la mise en œuvre du modèle autre que le MBH à celle du MBH. "

HBM.results[['Shrinkage']] %>%
  mutate(
    nonHBM.median = prettyNum(round(nonHBM.median, 3),decimal.mark=","),
    HBM.median= prettyNum(round(HBM.median, 3),decimal.mark=","),
    nonHBM.SD = prettyNum(round(nonHBM.SD, 3),decimal.mark=","),
    HBM.SD = prettyNum(round(HBM.SD, 3),decimal.mark=","),
    Shrinkage = paste0(round(Shrinkage * 100,1), " \\%"),
    Diff.SD = paste0(round(Diff.SD * 100,1), " \\%")
  ) %>%
      mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  rename(
    `Médiane dans l’autre modèle` = nonHBM.median,
    `Médiane dans le MBH` = HBM.median,
    `ET dans l’autre modèle` = nonHBM.SD,
    `ET dans le MBH` = HBM.SD,
	 `Rétré\ncissement` = Shrinkage,
    `Différence en pourcentage de l’ET` = Diff.SD,
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap #paste("(ref:tabSenRun1)", cap)
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

### Effet annuel commun

Les effets annuels communs représentent les écarts moyens par rapport aux prévisions de la productivité du stock par le modèle de Ricker parmi les stocks une année donnée (figure \@ref(fig:HBMYrEff)). Les estimations variaient d’une année à l’autre, de nombreuses années se rapprochant des prévisions du modèle de Ricker, tandis que d’autres affichaient des écarts positifs et négatifs sensibles. L’effet annuel commun de 1994 représentait le plus grand écart par rapport aux prévisions de la productivité du stock par le modèle de Ricker, avec une forte baisse de productivité. Les moyennes mobiles sur 4 et 5 ans fournissent des représentations lissées des effets annuels communs estimés dans des blocs de quatre et cinq ans et facilitent la visualisation des tendances communes possibles de la productivité des stocks par rapport aux graphiques des estimations annuelles. Les effets annuels communs découlent de la moyenne des écarts de productivité des stocks entre les stocks pour lesquels des données sur le stock-recrutement sont disponibles une année donnée et acquièrent de la crédibilité grâce à des écarts de productivité annuels communs à plusieurs des stocks. En revanche, les représentations de la productivité variable dans le temps par le filtre de Kalman reposent sur des séries chronologiques apparentes d’écarts par rapport aux prévisions par le modèle de Ricker de la productivité moyenne à long terme fondées sur les données d’un seul stock. L’approche du filtre de Kalman ne permet pas de représentation statistique potentielle des profils communs des écarts de productivité entre les stocks dans un bassin versant plus vaste. De plus, contrairement à l’approche de l’effet annuel commun, l’approche du filtre de Kalman ne peut pas être appliquée aux séries chronologiques de données sur le stock-recrutement lorsqu’il manque une ou plusieurs années de données dans une série chronologique.

<!-- FIGURE C.2. Common Shared Year Effect -->
```{r, echo=FALSE}
cap <- "Estimation de l’effet annuel commun aux 18 stocks de la rivière Skeena avec les moyennes mobiles sur 4 ans (A) et sur 5 ans (B) superposées. Les points indiquent la moyenne avec les barres d’erreur représentant les intervalles de crédibilité à 95 \\%, tandis que la ligne et l’ombrage dénotent la moyenne et les intervalles de crédibilité à 95 \\% pour la moyenne mobile."
```
```{r HBMYrEff, fig.width=7.5, fig.cap=cap}
include_graphics("data/1_FrenchFigs/FigApp_D2_Appendix-HBM-common_year_eff_FRENCH_Final.png")
```

Bien que ces écarts annuels, qu’ils découlent des effets annuels communs ou du filtre de Kalman, puissent représenter une amélioration ou une diminution de la survie dans le réseau dulcicole ou marin, ils peuvent aussi représenter une sous-estimation ou une surestimation de la prise totale, et il n’existe actuellement aucun moyen de faire la distinction entre l’effet authentique du taux de survie commun et les effets de l’erreur de reconstitution des remontes. Ainsi, il n’est pas possible d’attribuer les effets annuels négatifs ou positifs directement à un effet environnemental ou à la reconstitution des remontes, car les deux seront confondus.

Il faut donc considérer la productivité variable dans le temps comme une méthode d’amélioration de l’ajustement du modèle, mais qui ne fournit pas de critères objectifs qui peuvent être utilisés pour établir ou juger les réponses de gestion. Par exemple, lorsqu’il y avait des séries d’effets annuels communs fortement positifs ou négatifs les dernières années, elle pourrait refléter des séries de productivité élevée ou faible commune aux stocks. Il pourrait aussi s’agir d’une série d’années au cours desquelles les prises dans les pêches, pour la totalité ou la plupart des stocks, étaient systématiquement sous-déclarées ou surdéclarées. Si cette dernière hypothèse était correcte, les ajustements des règles de contrôle des prises, comme les ajustements des objectifs d’échappée, qui tentent de réagir aux changements de productivité apparents, pourraient alors avoir des conséquences imprévues sur l’atteinte des objectifs pour les pêches et la conservation des populations de saumon.

Afin d’évaluer la sensibilité des points de référence aux changements estimés de la productivité, les périodes de productivité élevée et faible ont été déterminées et les distributions prédictives a posteriori pour $S_{RMD}$ et $U_{RMD}$ ont été calculées en fonction des effets annuels communs dans ces blocs d’années à partir des estimations de la productivité variable dans le temps par stock (voir l’équation \@ref(eq:timevarprod)). Les années présentant les plus importants effets annuels communs, principalement positifs, allaient de 1980 à 1992 (figure \@ref(fig:HBMYrEff)). Les années présentant les plus faibles effets annuels communs, principalement négatifs, allaient de 1999 à 2014 (figure \@ref(fig:HBMYrEff)). Les estimations de $S_{RMD}$ et $U_{RMD}$ étaient nettement plus faibles dans le dernier bloc d’années, les moyennes a posteriori étant de 21 à 50 % plus basses que celles de la période de productivité élevée de 1980 à 1992 (tableaux \@ref(tab:SmsyProd) et \@ref(tab:UmsyProd)). Les intervalles de crédibilité à 95 % pour les différences en pourcentage pour $S_{RMD}$ et $U_{RMD}$ ne comprenaient que des valeurs négatives (tableaux \@ref(tab:SmsyProd) and \@ref(tab:UmsyProd)). Ces résultats permettent de penser que des réductions systématiques de la productivité des stocks pourraient donner des estimations réduites des deux. Si $S_{RMD}$ était utilisé pour établir des objectifs d’échappée et des points de référence pour la gestion des pêches et la conservation, une baisse de la productivité pourrait entraîner des objectifs d’échappée plus faibles. Étant donné que les estimations de $U_{RMD}$ sont fortement corrélées avec les estimations de $S_{RMD}$ , on pourrait également s’attendre à ce que les estimations de $U_{RMD}$ diminuent avec les estimations de $S_{RMD}$, et il serait également approprié de réduire les taux de récolte pour tenir compte de la baisse de la productivité. Toutefois, si seuls les changements des estimations de $S_{RMD}$ étaient pris en compte en réponse à des changements apparents de la productivité des stocks et si des réductions des taux de récolte n’étaient pas mises en œuvre, cela pourrait également avoir des conséquences imprévues sur l’atteinte des objectifs pour les pêches et la conservation des stocks.

\clearpage


<!-- TABLE C.4. Smsy in high/low years -->
```{r SmsyProd, echo=FALSE}
cap <- "Comparaison de $S_\\textrm{MSY}$ par stock pour les périodes de productivité élevée (de 1980 à 1992) et faible (de 1999 à 2014) et différence en pourcentage entre les périodes."

HBM.results[['Smsy Productivity']] %>%
  mutate(
    High = prettyNum(round(High),big.mark=" "),
    Low = prettyNum(round(Low),big.mark=" "),
    Diff      = ifelse(is.na(Diff), NA, paste0(round(Diff*100), " \\%")),
    Diff_2.5  = ifelse(is.na(Diff), NA, paste0(round(Diff_2.5*100), " \\%")),
    Diff_97.5 = ifelse(is.na(Diff), NA, paste0(round(Diff_97.5*100), " \\%"))
  ) %>%
        mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  # select(Low, High, Diff, Diff_2.5, Diff_97.5) %>%
  rename(
    Bassin = Basin,
    `Élevée` = High,
    `Faible` = Low,
    `\\% Diff` = Diff,
    `Limite\ninférieure\n– IC` = Diff_2.5,
    `Limite\nsupérieure\n– IC` =Diff_97.5
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("l", 6)),
    caption = cap #paste("(ref:tabSenRun1)", cap)
  ) %>%
  kableExtra::column_spec(2:5, width = "1.5cm")
```

\clearpage
<!-- TABLE C.5. Umsy in high/low years -->
```{r UmsyProd, echo=FALSE}
cap <- "Comparaison de $U_\\textrm{MSY}$ par stock pour les périodes de productivité élevée (de 1980 à 1992) et faible (de 1999 à 2014) et différence en pourcentage entre les périodes."

HBM.results[['Umsy Productivity']] %>%
  mutate(
    High = round(High,2),
    Low = round(Low,2),
    Diff      = ifelse(is.na(Diff), NA, paste0(round(Diff*100), "\\%")),
    Diff_2.5  = ifelse(is.na(Diff), NA, paste0(round(Diff_2.5*100), "\\%")),
    Diff_97.5 = ifelse(is.na(Diff), NA, paste0(round(Diff_97.5*100), "\\%"))
  ) %>%
        mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  # select(Low, High, Diff, Diff_2.5, Diff_97.5) %>%
  rename(
    Bassin = Basin,
    `Élevée` = High,
    `Faible` = Low,
    `\\% Diff` = Diff,
    `Limite\ninférieure\n– IC` = Diff_2.5,
    `Limite\nsupérieure\n– IC` =Diff_97.5
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("l", 6)),
    caption = cap #paste("(ref:tabSenRun1)", cap)
  ) %>%
  kableExtra::column_spec(2:5, width = "1.5cm")
```

\newpage
### Analyse de sensibilité 1 : Effet de l’erreur de codage de Korman et English (2013) pour leur MBH {#app:HBMFits-2-1}
```{r, echo=FALSE}
sig.mean <- (HBM.results$`Run 1`$Diff.mean * 100) %>% range() %>% round
sig.sd <- (HBM.results$`Run 1`$Diff.SD * 100) %>% range() %>% round
```

Il y avait une erreur de codage dans le modèle utilisé par @KormanEnglish2013; leur code a transformé incorrectement le paramètre $\sigma_i$ en $\tau_i$ en utilisant le mauvais code,  \texttt{tau[i]<-pow(sd[i],-0.5)}, qui aurait dû être \texttt{tau[i]<-pow(sd[i],-2)}. Cette erreur de codage a très peu modifié les résultats a posteriori du MBH pour les paramètres $a$ et $\beta$ de Ricker des 18 stocks (tableau \@ref(tab:SenRun1)). Cependant, les estimations du paramètre $\sigma_i$ se situaient entre -72 et 229 % de celles obtenues dans le scénario de référence du MBH. Les écarts-types a posteriori pour $\sigma_i$ variaient entre 24 et 889 % de plus que ceux obtenus dans le scénario de référence. La borne inférieure ou supérieure de la valeur a priori de $\sigma_i$ a été atteinte pour certains stocks. Si l’erreur de codage avait persisté, les simulations des données sur le stock-recrutement réalisées à l’aide des valeurs estimées pour $\sigma_i$ auraient pu donner des résultats présentant une variabilité excessive. Il est donc essentiel de corriger cette erreur de codage dans les futures mises en œuvre du MBH de @KormanEnglish2013.


<!-- TABLE C.6 Sensitivity Run 1 -->
```{r SenRun1, echo=FALSE, results='asis'}
cap <- "Moyennes a posteriori et écarts types a posteriori pour $\\sigma$ dans le scénario de référence (erreur de codage supprimée) et l’exécution du modèle qui incluait l’erreur de codage de Korman et English (2013)."

HBM.results[['Run 1']] %>%
  mutate(
    Base.Case.mean = prettyNum(round(Base.Case.mean, 3),decimal.mark = ","),
    Code.Error.mean = prettyNum(round(Code.Error.mean, 3),decimal.mark = ","),
    Base.Case.SD = prettyNum(round(Base.Case.SD, 3),decimal.mark = ","),
    Code.Error.SD = prettyNum(round(Code.Error.SD, 3),decimal.mark = ","),
    Diff.mean = paste0(round(Diff.mean*100), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100), "\\%")
  ) %>%
     mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  rename(
    `Moyenne de $\\sigma$\ndans le scénario\nde référence` = Base.Case.mean,
    `Moyenne de $\\sigma$\navec l’erreur\nde code` = Code.Error.mean,
    `\\% Diff` = Diff.mean,
    `ET ($\\sigma$) dans le\nscénario de référence` = Base.Case.SD,
    `ET ($\\sigma$) avec\nl’erreur\nde code` = Code.Error.SD,
    `\\% Diff ` = Diff.SD,
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap #paste("(ref:tabSenRun1)", cap)
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```



\clearpage
### Analyse de sensibilité 2 : Identique au scénario de référence du MBH, mais avec borne inférieure a priori sur le paramètre $\beta$ de Ricker 

Lorsqu’aucune borne inférieure a priori n’incluait le paramètre $\beta$ de Ricker par stock, les estimations de $S_\textrm{max}$  et des points de référence fondés sur le RMD comprenaient certaines valeurs extrêmement élevées de la chaîne MCCM qui étaient très loin dans les queues des chaînes de Markov et très éloignées de la fourchette des valeurs confirmées par les données; pour ces stocks, les moyennes a posteriori, les médianes et les valeurs de l’intervalle de probabilité étaient très sensibles à l’inclusion de ces valeurs aberrantes extrêmes dans les chaînes (voir des exemples de résultats pour $S_\textrm{RMD}$  dans le tableau \@ref(tab:SenRun2)). Il est courant dans les mises en œuvre MCCM, comme WinBUGS, d’établir des bornes pour les variables clés du modèle afin d’empêcher que des valeurs aberrantes extrêmes dans les chaînes n’aient une incidence sur les calculs a posteriori [p. ex. @MeyerMillar1999; @MichielsensMcAllister2004]. Il est donc recommandé de mettre en œuvre des bornes inférieures a priori sur le paramètre $\beta$ de Ricker pour chaque stock afin d’éliminer cette source de biais.

Les estimations de $U_\textrm{RMD}$  dans le MBH étaient relativement insensibles à l’élimination de la borne maximale a priori sur $S_\textrm{max}$   (tableau \@ref(tab:SenRun2Umsy)). Alors que les moyennes a posteriori différaient de moins de quelques points de pourcentage pour l’ensemble des stocks, les valeurs de l’écart type a posteriori étaient jusqu’à 13 \%  plus élevées lorsque l’on a éliminé la borne maximale a priori.


<!-- TABLE C.7 Sensitivity Run 2 -->
```{r SenRun2, echo=FALSE, results='asis'}
cap <- "Moyennes a posteriori et écarts types a posteriori pour $S_\\textrm{MSY}$ dans le scénario de référence du MBH et l’exécution du modèle où aucune borne maximale a priori n’a été placée sur \\Smax."

HBM.results[['Run 2 Smsy']] %>%
  mutate(
    Base.Case.mean = prettyNum(round(Base.Case.mean),big.mark = " "),
    No.Bound.mean = prettyNum(round(No.Bound.mean),big.mark = " "),
    Base.Case.SD = prettyNum(round(Base.Case.SD),big.mark = " "),
    No.Bound.SD = prettyNum(round(No.Bound.SD),big.mark = " "),
    Diff.mean = paste0(round(Diff.mean*100,1), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 1), "\\%")
  ) %>%
   mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
    mutate(Stock = gsub( "Sum Smsy across stocks", "Somme de SRMD entre les stocks" ,Stock)) %>% 
  rename(
    `Moyenne de $S_\\textrm{RMD}$ dans le scénario de référence` = Base.Case.mean,
    `Moyenne de $S_\\textrm{RMD}$ sans borne` = No.Bound.mean,
    `\\% Diff` = Diff.mean,
    `ET($S_\\textrm{MSY}$) dans le scénario de référence` = Base.Case.SD,
    `ET($S_\\textrm{MSY}$) sans borne` = No.Bound.SD,
    `\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap, #paste("(ref:tabSenRun2)", cap)
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

<!-- TABLE C.8 Sensitivity Run 2 -->
```{r SenRun2Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the HBM base case and model run where no prior upper bounds were placed on \\Smax."

HBM.results[['Run 2 Umsy']] %>%
  mutate(
    Base.Case.mean = prettyNum(round(Base.Case.mean,3),decimal.mark = ","),
    No.Bound.mean = prettyNum(round(No.Bound.mean,3),decimal.mark = ","),
    Base.Case.SD = prettyNum(round(Base.Case.SD,3),decimal.mark = ","),
    No.Bound.SD = prettyNum(round(No.Bound.SD,3),decimal.mark = ","),
    Diff.mean = paste0(round(Diff.mean*100,1), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 1), "\\%")
  ) %>%
     mutate(Stock = gsub( "Babine Early Wild", "Babine sauvage hâtive" ,Stock)) %>%
   mutate(Stock = gsub( "Babine Late Wild", "Babine sauvage tardive" ,Stock)) %>%
    mutate(Stock = gsub( "Babine Mid Wild", "Babine sauvage moyenne" ,Stock)) %>%
  rename(
    `Base Case mean $U_\\textrm{MSY}$` = Base.Case.mean,
    `No Bound mean $U_\\textrm{MSY}$` = No.Bound.mean,
    `\\% Diff` = Diff.mean,
    `Base Case SD($U_\\textrm{MSY}$)` = Base.Case.SD,
    `No Bound SD($U_\\textrm{MSY}$)` = No.Bound.SD,
    `\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap, #paste("(ref:tabSenRun2)", cap)
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
### Sensitivity Run 3: Same as HBM Base Case But Leaving Out Common Shared Year Effects

```{r, echo=FALSE}
sig.mean <- (HBM.results[['Run 3 Smsy']]$Diff.mean * 100)  %>% range() %>% round
sig.sd <- (HBM.results[['Run 3 Smsy']]$Diff.SD * 100) %>% range()  %>% round
```

Significant, strong common shared year effects were estimated for numerous years in the 1960-2014 brood year time series.  Separating out this effect provided more precise estimates of Ricker stock recruit parameters for several of the stocks and more precise estimates of management quantities of interest.  This also allowed for common shared systematic change in stock productivity to be estimated.  The posterior means for the Smsy reference point by stock for example were between about `r sig.mean[1]`% and `r sig.mean[2]`% different between runs when common shared year effects were excluded versus accounted for (Table \@ref(tab:SenRun3)).  When no common shared year effect was included in the HBM, estimates of Ricker stock-recruit parameters and associated management parameters for several of the stocks were on average less precisely estimated with posterior SDs being up to about `r sig.sd[2]`% larger for $S_\textrm{msy}$ for several of the stocks.

The $U_\textrm{MSY}$ estimates from the HBM were relatively insensitive to removing common shared year effects from the HBM (Table \@ref(tab:SenRun3Umsy)).  

<!-- TABLE C.9 Sensitivity Run 3 -->
```{r SenRun3, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $S_\\textrm{MSY}$ from the HBM base case and model run where no prior upper bounds were placed on \\Smax."

HBM.results[['Run 3 Smsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean),
    No.TE.mean = round(No.TE.mean),
    Base.Case.SD = round(Base.Case.SD),
    No.TE.SD = round(No.TE.SD),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $S_\\textrm{MSY}$` = Base.Case.mean,
  	`No \\newline $T_y$ \\newline mean $S_\\textrm{MSY}$` = No.TE.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($S_\\textrm{MSY}$)` = Base.Case.SD,
  	`No \\newline $T_y$ \\newline SD($S_\\textrm{MSY}$)` = No.TE.SD,
  	`\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap #paste("(ref:tabSenRun3)", cap)
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

<!-- Table C.10 Sensitivity Run 3 -->
```{r SenRun3Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the HBM base case and model run where no prior upper bounds were placed on \\Smax."

HBM.results[['Run 3 Umsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean, 3),
    No.TE.mean = round(No.TE.mean, 3),
    Base.Case.SD = round(Base.Case.SD, 3),
    No.TE.SD = round(No.TE.SD, 3),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $U_\\textrm{MSY}$` = Base.Case.mean,
  	`No \\newline $T_y$ \\newline mean $U_\\textrm{MSY}$` = No.TE.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($U_\\textrm{MSY}$)` = Base.Case.SD,
  	`No \\newline $T_y$ \\newline SD($U_\\textrm{MSY}$)` = No.TE.SD,
  	`\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap #paste("(ref:tabSenRun3)", cap)
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
### Sensitivity Run 4: Non-Hierarchical Model Run With No Common Shared Year Effect But Including the Same $S_\textrm{max}$ Prior Information As in the Base Case HBM

```{r, echo=FALSE}
sig.mean <- (HBM.results[['Run 4 Smsy']]$Diff.mean * 100) %>% range()  %>% round
sig.sd <- (HBM.results[['Run 4 Smsy']]$Diff.SD * 100) %>% range()  %>% round

smsy.diff <- filter(HBM.results[['Run 4 Smsy']], Stock == "Sum Smsy across stocks") %>% select(Diff.mean, Diff.SD) %>% unlist * 100 %>% round

umsy.diff <- HBM.results[['Run 4 Umsy']] %>% select(Diff.SD) %>% unlist %>% max
umsy.diff <- round(umsy.diff*100)
```


When a nonhierarchical Bayesian model(nonHBM) with no common shared year effects was run, estimates of Ricker stock-recruit parameters and associated management parameters for several of the stocks were on average less precisely estimated with posterior SD in Smsy for example on average being about `r sig.sd[1]`% to `r sig.sd[2]`% different between the nonHBM and HBM runs (Table \@ref(tab:SenRun4)).  Percentage differences between the nonHBM and HBM for posterior mean estimates for Smsy parameters ranged by stock between `r sig.mean[1]`% and `r sig.mean[2]`%.  These results indicate that on average Ricker and msy-based parameter estimates are more precisely estimated with the HBM and results for some quantities for some stocks can differ considerably.  However, the sum of the $S_\textrm{MSY}$ estimates across stocks was only about `r round(smsy.diff['Diff.mean'])`% larger under the non-hierarchical model but the posterior SD in the $S_\textrm{MSY}$ values summed over the Skeena River stocks was `r round(smsy.diff['Diff.SD'])`% larger than that for the HBM (Table \@ref(tab:SenRun4)).

The posterior means for  $U_\textrm{MSY}$ were relatively insensitive to fitting a nonHBM, but the posterior SDs for $U_\textrm{MSY}$ mostly increased by up to `r umsy.diff`% larger than those under the HBM  (Table \@ref(tab:SenRun4Umsy)).  

<!-- TABLE C.11 - Sensitivity Run 4 -->
```{r SenRun4, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $S_\\textrm{MSY}$ from the base case HBM and nonHBM run."

HBM.results[['Run 4 Smsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean),
    nonHBM.mean = round(nonHBM.mean),
    Base.Case.SD = round(Base.Case.SD),
    nonHBM.SD = round(nonHBM.SD),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $S_\\textrm{MSY}$` = Base.Case.mean,
  	`nonHBM \\newline mean $S_\\textrm{MSY}$` = nonHBM.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($S_\\textrm{MSY}$)` = Base.Case.SD,
  	`nonHBM \\newline SD($S_\\textrm{MSY}$)` = nonHBM.SD,
  	`\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

<!-- TABLE C.12 - Sensitivity Run 4 -->
```{r SenRun4Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the base case HBM and nonHBM run."

HBM.results[['Run 4 Umsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean, 3),
    nonHBM.mean = round(nonHBM.mean, 3),
    Base.Case.SD = round(Base.Case.SD, 3),
    nonHBM.SD = round(nonHBM.SD, 3),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $U_\\textrm{MSY}$` = Base.Case.mean,
  	`nonHBM \\newline mean $U_\\textrm{MSY}$` = nonHBM.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($U_\\textrm{MSY}$)` = Base.Case.SD,
  	`nonHBM \\newline SD($U_\\textrm{MSY}$)` = nonHBM.SD,
  	`\\% Diff ` = Diff.SD
  ) %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
### Sensitivity Run 5: Normal Priors on Smax in the HBM Instead of the Lognormal Prior on Ricker $\beta$

```{r, echo=FALSE}
sig.mean <- (HBM.results[['Run 5 Smsy']]$Diff.mean * 100) %>% range()  %>% round
sig.sd <- (HBM.results[['Run 5 Smsy']]$Diff.SD * 100) %>% range()  %>% round
```

When a normal prior for $S_\textrm{max}$ was applied instead of a lognormal prior on the Ricker $\beta$ parameter in the HBM, but otherwise using the same input information from the lake productivity analyses, the posterior estimates for several of the quantities became less precise and posterior estimates differed markedly for some of the quantities.  Posterior SDs for $S_\textrm{MSY}$ were for example much larger on average, e.g., between about `r sig.sd[1]`% and `r sig.sd[2]`% larger (Table \@ref(tab:SenRun5)).  Posterior mean estimates for $S_\textrm{MSY}$ differed between the two model runs by `r sig.mean[1]`% to `r sig.mean[2]`%.  Though it appears the same information is used in a normal prior for $S_\textrm{max}$, this prior on average loses information about the Ricker $\beta$ parameter compared to a prior for the Ricker $\beta$ parameter that uses the same $S_\textrm{max}$ information. 

The $U_\textrm{MSY}$ estimates from the HBM were relatively insensitive to replacing the lognormal prior for the Ricker $\beta$ parameter with a normal prior for  $S_\textrm{max}$ (Table \@ref(tab:SenRun5Umsy)). 

<!-- TABLE C.13 - Sensitivity Run 5 -->
```{r SenRun5, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $S_\\textrm{MSY}$ from the HBM base case and model run with a Normal priors on $S_\\textrm{max}$."

HBM.results[['Run 5 Smsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean),
    Normal.Prior.mean = round(Normal.Prior.mean),
    Base.Case.SD = round(Base.Case.SD),
    Normal.Prior.SD = round(Normal.Prior.SD),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $S_\\textrm{MSY}$` = Base.Case.mean,
  	`Normal Prior mean $S_\\textrm{MSY}$` = Normal.Prior.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($S_\\textrm{MSY}$)` = Base.Case.SD,
  	`Normal Prior SD($S_\\textrm{MSY}$)` = Normal.Prior.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
<!-- TABLE C.14 - Sensitivity Run 5 -->
```{r SenRun5Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the HBM base case and model run with a Normal priors on $S_\\textrm{max}$."

HBM.results[['Run 5 Umsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean, 3),
    Normal.Prior.mean = round(Normal.Prior.mean, 3),
    Base.Case.SD = round(Base.Case.SD, 3),
    Normal.Prior.SD = round(Normal.Prior.SD, 3),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $U_\\textrm{MSY}$` = Base.Case.mean,
  	`Normal Prior mean $U_\\textrm{MSY}$` = Normal.Prior.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($U_\\textrm{MSY}$)` = Base.Case.SD,
  	`Normal Prior SD($U_\\textrm{MSY}$)` = Normal.Prior.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
### Sensitivity Run 6: Application of Vague Ricker $\beta$ Priors in the HBM, but Including the Prior Lower Bound on $\beta$
```{r, echo=FALSE}
sig.mean <- (HBM.results[['Run 6 Smsy']]$Diff.mean * 100) %>% range() %>% round
sig.sd <- (HBM.results[['Run 6 Smsy']]$Diff.SD * 100) %>% range() %>% round

umsy.diff <- HBM.results[['Run 6 Umsy']] %>% select(Diff.mean) %>% unlist %>% max
umsy.diff <- round(umsy.diff*100)
```

When a vague prior was applied for the Ricker $\beta$ prior for all 18 Skeena Sockeye salmon stocks in the HBM, posterior estimates for the abundance-based management quantities were less precise on average with posterior SDs, e.g., for \Smsy ranging between `r sig.sd[1]`% to `r sig.sd[2]`% larger under the vague priors (Table \@ref(tab:SenRun6)).  Posterior means for $S_\textrm{MSY}$ estimates in the HBM that used vague priors for the Ricker $\beta$ parameter were between about `r sig.mean[1]`% and `r sig.mean[2]`% different from those obtained under the mixture of informed and vague priors in the base case HBM.  The use of informative priors for the Ricker $\beta$ parameter based on prior information on $S_\textrm{max}$ via the lake productivity analyses thus combined with the data to provide more precise stock-recruit parameter estimates that in some cases differed from the less precise estimates given by the stock-recruit data.  


The $U_\textrm{MSY}$ estimates from the HBM were relatively insensitive to prior for all Ricker $\beta$ parameter vague priors though for a few of the stocks the posterior means were up to `r umsy.diff`% larger (Table \@ref(tab:SenRun6Umsy)). 

<!-- TABLE C.15 - Sensitivity Run 6 -->
```{r SenRun6, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $S_\\textrm{MSY}$ from the HBM base case and model run with a Normal priors on $S_\\textrm{max}$."

HBM.results[['Run 6 Smsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean),
    Vague.Prior.mean = round(Vague.Prior.mean),
    Base.Case.SD = round(Base.Case.SD),
    Vague.Prior.SD = round(Vague.Prior.SD),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $S_\\textrm{MSY}$` = Base.Case.mean,
  	`Vague $\\beta$ Prior mean $S_\\textrm{MSY}$` = Vague.Prior.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($S_\\textrm{MSY}$)` = Base.Case.SD,
  	`Vague $\\beta$ Prior SD($S_\\textrm{MSY}$)` = Vague.Prior.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

<!-- TABLE C.16 - Sensitivity Run 6 -->
```{r SenRun6Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the HBM base case and model run with a Normal priors on $S_\\textrm{max}$."

HBM.results[['Run 6 Umsy']] %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean, 3),
    Vague.Prior.mean = round(Vague.Prior.mean, 3),
    Base.Case.SD = round(Base.Case.SD, 3),
    Vague.Prior.SD = round(Vague.Prior.SD, 3),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean $U_\\textrm{MSY}$` = Base.Case.mean,
  	`Vague $\\beta$ Prior mean $U_\\textrm{MSY}$` = Vague.Prior.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD($U_\\textrm{MSY}$)` = Base.Case.SD,
  	`Vague $\\beta$ Prior SD($U_\\textrm{MSY}$)` = Vague.Prior.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

\clearpage
### Sensitivity Runs 7-25.  Leave Out Stock-Recruit Data in the HBM, One Stock at a Time

To evaluate the relative influence of each stock-recruit data set from each stock, the HBM was run dropping out the stock-recruit data for one stock at a time.  In run 25 the stock-recruit data for both of the Babine Enhanced stocks (i.e., Fulton and Pinkut) were left out of the HBM.  The posterior predictive distribution for the Ricker $a$ parameter for an “unsampled” stock was computed for each of these runs (see equation \@ref(eq:unsamp)).  The posterior predictive distributions were plotted under each of the HBM runs 7-25 and under the base case HBM shows that the posterior predictive distributions were very similar between all HBM runs 7-25 and the base case HBM run (Figure \@ref(fig:jackProd)).  The posterior mean estimates of the time series of common shared year effects also did not change their sign or markedly change in magnitude when the stock-recruit data from one of the stocks or both of the Babine enhanced stocks were removed from the HBM (Figure \@ref(fig:jackTE)).  These results indicate that no one stock, nor the enhanced Babine Sockeye salmon stocks, had a substantive influence on the HBM results.  Furthermore results indicate that regardless of whether Pinkut and Fulton channel data were included or excluded, very similar among stocks posterior distribution of the Ricker $a$ parameter (Figure \@ref(fig:jackProd)) and shared year-effects on productivity (Figure \@ref(fig:jackTE)) were produced.  

The temporal variation in shared year effect estimates represent the combined effects of potential changes in both freshwater and marine processes (Figure \@ref(fig:jackTE)).  The combined effects of spawning channels on recruits/spawner are clearly similar to those of nearby natural spawning streams (Figure \@ref(fig:jackTE)).  However, by providing more spawning gravel, the channels have increased the total abundance of adult recruits and spawners in the Skeena system (Randall Peterman, pers. comm.).

<!-- Figure C.3 - Sensitivity Run 7-25 -->
```{r, echo=FALSE}
cap <- "Posterior predictive distributions for the Ricker $a$ parameter when the Sockeye salmon stock-recruit data from one stock at a time was dropped from the HBM for the Skeena watershed (runs 7-24) and the stock-recruit data were dropped for both of the Babine Enhanced Sockeye salmon stocks, i.e., both Pinkut and Fulton (run 25). Base case posterior predictive distribution is coloured dark grey, with colours used for runs 7-25."
```
```{r jackProd,   fig.cap=cap}
include_graphics("data/HBM/Appendix-HBM-Productivity-jackknife.pdf")
```

<!-- Figure C.4 - Sensitivity Run 7-25 -->
```{r, echo=FALSE}
cap <- "Posterior mean estimates for the common shared year effect when the Sockeye salmon stock-recruit data from one stock at a time was dropped from the HBM for the Skeena watershed (runs 7-24) and the stock-recruit data were dropped for both of the Babine Enhanced Sockeye salmon stocks, i.e., both Pinkut and Fulton (run 25). Base case posterior predictive distribution is coloured dark grey, with colours used for runs 7-25."
```
```{r jackTE,   fig.cap=cap}
include_graphics("data/HBM/Appendix-HBM-yeareffect-jackknife.pdf")
```



\clearpage
### Sensitivity Run 26: Removal of Enhanced Stocks and Vague Ricker $\beta$ Priors for Select Stocks
```{r, echo=FALSE}
sig.mean <- (HBM.results[['Run 26 Smsy']]$Diff.mean * 100) %>% range() %>% round
sig.sd <- (HBM.results[['Run 26 Smsy']]$Diff.SD * 100) %>% range() %>% round


smsy.diff <- HBM.results[['Run 26 Smsy']] %>% 
  # select(Stock, Diff.mean, Diff.SD) %>% 
  arrange (Diff.mean) %>%
  mutate(Base.Case.CV = round(Base.Case.SD /Base.Case.mean*100)) %>%
   mutate(Run.26.CV = round(Run.26.SD /Run.26.mean*100)) %>%
  mutate(Perc.Diff =  round(Diff.mean*100), Perc.SD =  round(Diff.SD*100)) %>%
  arrange(Stock)
smsy.diff2 <- smsy.diff %>% filter(Stock %in% c("Bear", "Kitwanga", "Sustut"))

umsy.diff <- HBM.results[['Run 26 Umsy']] %>% select(Stock, Diff.mean) %>% 
  arrange (Diff.mean) %>% 
  mutate(Perc =  round(Diff.mean*100)) %>%
  tail(n=2) %>%
  arrange(Stock)
# umsy.diff <- round(umsy.diff*100)
```

For the final sensitivity run (hereafter, 'run 26') the enhanced stocks were removed and vague priors were applied to the Ricker $\beta$ prior for Bear, Kitwanga and Sustut, which were stocks highlighted as stocks of interest when the HBM results were compared to results form single stock models.  Estimates of the posterior mean for the abundance-based management quantity \Smsy were generally similar to the base case (i.e., less than 10% change) for stocks where the \Smax prior was not changed relative to the base case. The exception was Babine Late Wild, which had a `r filter(smsy.diff, Stock %in% c("Babine Late Wild"))$Perc.Diff`% reduction in the \Smsy estimate, however Babine Late Wild also had the highest posterior SD estimate of all stocks with a CV of `r filter(smsy.diff, Stock %in% c("Babine Late Wild"))$Base.Case.CV`% and `r filter(smsy.diff, Stock %in% c("Babine Late Wild"))$Run.26.CV`% for  base case and run 26 respectively. For Bear, Kitwanga, and Sustut applying a vague prior resulted in declines in the posterior mean of \Smsy  from `r max(smsy.diff2$Perc.Diff)`% to `r min(smsy.diff2$Perc.Diff)`% relative to the base case. Precision in \Smsy estimates varied from stock to stock ranging from a `r -sig.sd[1]`% reduction in the posterior SD to an increase of  `r sig.sd[2]`% relative to the base case (Table \@ref(tab:SenRun26)). For Bear, and Sustut the posterior SD was reduced (`r pasteList(-filter(smsy.diff, Stock %in% c("Bear", "Sustut"))$Perc.SD, "\\%")` respectively), while for Kitwanga the Posterior SD was increased by `r filter(smsy.diff, Stock %in% c("Kitwanga"))$Perc.SD`%. For stocks where changes were not applied to the \Smax  prior changes to the posterior SD ranged from  `r filter(smsy.diff, Stock %in% c("Bear", "Sustut", "Kitwanga") == FALSE)$Perc.SD %>% min`% to `r filter(smsy.diff, Stock %in% c("Bear", "Sustut", "Kitwanga") == FALSE)$Perc.SD %>% max`%.


The \Umsy posterior estimates  were relatively insensitive to these changes implemented in run 26 (i.e., under 10% change in the posterior mean), the exceptions were `r pasteList(umsy.diff$Stock[1:2])` which had posterior means that were   `r pasteList(umsy.diff$Perc[1:2], "\\%")` larger (Table \@ref(tab:SenRun26Umsy)). 

<!-- TABLE C.17 - Sensitivity Run 26 -->
```{r SenRun26, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $S_\\textrm{MSY}$ from the HBM base case and model run where enhanced stocks were removed and vague $S_\\textrm{max}$ priors  were used for Bear, Kitwanga, and Sustut."

HBM.results[['Run 26 Smsy']] %>%
  filter(Stock %in% c("Pinkut","Fulton") == FALSE) %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean),
    Run.26.mean = round(Run.26.mean),
    Base.Case.SD = round(Base.Case.SD),
    Run.26.SD = round(Run.26.SD),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean \\Smsy` = Base.Case.mean,
  	`Run 26 mean \\Smsy` = Run.26.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD(\\Smsy)` = Base.Case.SD,
  	`Run 26 SD(\\Smsy)` = Run.26.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::row_spec(18, hline_after = TRUE) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```

<!-- TABLE C.18 - Sensitivity Run 26 -->
```{r SenRun26Umsy, echo=FALSE, results='asis'}
cap <- "Posterior means and posterior standard deviations for $U_\\textrm{MSY}$ from the HBM base case and model run where enhanced stocks were removed and vague  $S_\\textrm{max}$ priors were used for Bear, Kitwanga, and Sustut."

HBM.results[['Run 26 Umsy']] %>%
  filter(Stock %in% c("Pinkut","Fulton") == FALSE) %>%
  mutate(
    Base.Case.mean = round(Base.Case.mean, 3),
    Run.26.mean = round(Run.26.mean, 3),
    Base.Case.SD = round(Base.Case.SD, 3),
    Run.26.SD = round(Run.26.SD, 3),
    Diff.mean = paste0(round(Diff.mean*100,0), "\\%"),
    Diff.SD = paste0(round(Diff.SD * 100, 0), "\\%")
  ) %>%
  rename(
  	`Base Case mean \\Umsy` = Base.Case.mean,
  	`Run 26 mean \\Umsy` = Run.26.mean,
  	`\\% Diff` = Diff.mean,
  	`Base Case SD(\\Umsy)` = Base.Case.SD,
  	`Run 26 SD(\\Umsy)` = Run.26.SD,
  	`\\% Diff ` = Diff.SD
  )  %>%
  csas_table(
    format = "latex",
    escape = FALSE, 
    font_size = 10,
    align = c("l", rep("r", 6)),
    caption = cap 
  ) %>%
  kableExtra::column_spec(2:7, width = "1.5cm")
```


## Summary

HBM analysis provides an effective approach to formulating priors for key parameters in Bayesian ecological models and has often been applied to estimate productivity parameters for Pacific and Atlantic salmon and other fish species populations [@PrevostOthers2003; @MichielsensMcAllister2004; @SuPetermanHaeseker2004; @Clark2004; @ForestOthers2010; @PulkkinenOthers2011].  The diagnostics shown in this appendix which are routine to HBM analysis [e.g., @GelmanOthers2004; @MichielsensMcAllister2004; @ForestOthers2010] support the basic HBM assumption of exchangeability of the datasets from all 18 stocks with regards to the Ricker  $a$ parameter.  We did not find evidence to support the notion that the two enhanced stocks have consistently different productivity than the non-enhanced stocks.  This is for example based on results (1) from both HBM and non-HBM runs shown in Table \@ref(tab:HBMShrinkageVal) where the posterior means for the Ricker $a$ parameter for the two enhanced stocks were neither consistently higher nor lower than estimates from the 16 non-enhanced stocks, and (2) from the jackknife analysis which showed that the posterior predictive distribution for Ricker $a$ was highly insensitive to leaving out the two enhanced stocks, either one at a time or both at the same time (Figure \@ref(fig:jackProd)).  

Comparisons from the non-HBM and HBM also show that there was a moderate but not extreme amount of shrinkage in Ricker $a$ parameter estimates, where the maximum percentage change in Ricker $a$ was no more than 20% and less than 10% in 13 of the 18 stocks when going from the non-HBM to the HBM.  Shrinkage is to be expected in HBM analysis and the amount of shrinkage found here was not excessive and not so for the two enhanced stocks.  The posterior SDs of the Ricker $a$ parameter for the two enhanced stocks from the non-HBM and HBM (Table \@ref(tab:HBMShrinkageVal)) were also neither consistently larger nor smaller than the posterior SDs for this parameter for the 16 wild stocks.  The estimates of derived parameters such as \Smsy for the two enhanced stocks were also not excessively imprecise with posterior CVs for \Smsy being 0.56 for Pinkut and 0.37 for Fulton (Table \@ref(tab:SenRun2)).  These posterior CVs are well within the range of posterior CVs for fish stock parameters commonly estimated using Bayesian methods. <!--These results thus also refute the notion that due to lack of contrast in the spawner data from the practice of channel loading, the parameter estimates obtained from fitting a Ricker model to their stock recruit data will be excessively imprecise.  -->

Estimation of common shared year effects showed that the estimated effects were statistically significant with 95% PIs not overlapping with zero for 18 of the 55 years.  The estimated effects were highly pronounced in some years, and could change abruptly and considerably in relatively few years.  For example, the estimated effects went from the absolute minimum to the absolute maximum extreme in three years, i.e., -1.37 in 1994 to +1.02 in 1997.  And the most pronounced year effect of all could be linked to epizootic disease event, e.g., in 1994, indicating that at least some of the estimated effects could be attributed to ecological events and the notion that the estimated effects were all due to stock assessment errors is unlikely.  

The above results on common shared year effects suggest that caution is needed should it be of interest to implement random walk models for the Ricker $a$ parameter.  Random walk models typically assume that there exists positive correlation between adjacent years, e.g., for the Ricker $a$ parameter, and tend to provide smoothed trajectories of parameter estimates.  When estimates of common shared year effects from models that exclude random walk jump abruptly been years and shift from minimum to maximum value in only a few years, bias in annual estimates of the Ricker $a$ parameter could thus be expected from random walk models for this parameter.  The common shared year effect also suggested, despite frequent extreme variation between years, extended periods of on average potentially higher productivity in the 1980s to early 1990s and lower than average productivity from 2003-2014.  Estimates of quantities of interest such as \Smsy were also moderately sensitive to the inclusion and exclusion of common shared year effects in the HBM (Table \@ref(tab:SenRun3))).  

Careful attention to how the prior for \Smax was applied in MCMC was also an important consideration in the analysis.  In MCMC integration, values for estimated parameters in Markov Chains even after burn in can wander considerably and occasionally jump to extreme values well outside of the area of support of the data when no constraints are imposed.  The presence of extreme values in approximations of posteriors from MCMC can potentially cause pronounced bias in the estimated parameters.  We found that this was the case in the application of the non-HBM and HBM and extreme parameter values and the incidence in MCMC chains of quantities of interest such as Smsy could be eliminated by implementation of upper and lower bounds for key parameters such as \Smax or Ricker $\beta$.  It is thus appropriate to apply upper and lower bounds for key parameters in MCMC code to prevent these rare but extreme values from occurring and biasing posterior results.  
